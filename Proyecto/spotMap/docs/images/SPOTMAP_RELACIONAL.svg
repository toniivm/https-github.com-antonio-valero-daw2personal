<?xml version="1.0" encoding="UTF-8"?>
<svg width="3200" height="2800" xmlns="http://www.w3.org/2000/svg" style="background-color: #FAFAFA;">
  <defs>
    <style>
      .title { font-size: 36px; font-weight: bold; fill: #1E3A8A; font-family: 'Segoe UI', Arial, sans-serif; }
      .subtitle { font-size: 14px; fill: #666; font-family: 'Segoe UI', Arial, sans-serif; }
      .table-name { font-size: 15px; font-weight: bold; fill: white; font-family: 'Segoe UI', Arial, sans-serif; }
      .field-name { font-size: 12px; fill: #1F2937; font-family: 'Segoe UI', Arial, sans-serif; }
      .field-type { font-size: 10px; fill: #666; font-weight: 500; font-family: 'Segoe UI', Arial, sans-serif; }
      .legend { font-size: 12px; fill: #4B5563; font-family: 'Segoe UI', Arial, sans-serif; }
    </style>
  </defs>

  <rect width="3200" height="2800" fill="#FAFAFA"/>
  
  <!-- Header -->
  <rect width="3200" height="80" fill="#F0F9FF" stroke="#10B981" stroke-width="2"/>
  <text x="1600" y="45" text-anchor="middle" class="title">ESQUEMA RELACIONAL - SpotMap</text>
  <text x="1600" y="68" text-anchor="middle" class="subtitle">PostgreSQL 14+ | 11 Tablas Normalizadas 3NF | Optimizado para Rendimiento</text>

  <!-- Legend -->
  <text x="100" y="130" class="legend" font-weight="bold">ğŸ”‘ PK = Clave Primaria | ğŸ”— FK = Clave ForÃ¡nea | âš« NOT NULL | ğŸ”„ UNIQUE | ğŸ“Š INDEX | AI = Auto-Increment</text>

  <!-- USERS Table -->
  <g><rect x="80" y="200" width="280" height="360" fill="#DBEAFE" stroke="#0369A1" stroke-width="2" rx="4"/>
    <rect x="80" y="200" width="280" height="35" fill="#0369A1" rx="4"/>
    <text x="220" y="228" text-anchor="middle" class="table-name">USERS</text>
    <line x1="80" y1="235" x2="360" y2="235" stroke="#0369A1" stroke-width="1"/>
    <text x="95" y="260" class="field-name">ğŸ”‘ id: UUID | PK</text>
    <text x="95" y="280" class="field-name">ğŸ“§ email: VARCHAR(255) UNIQUE</text>
    <text x="95" y="300" class="field-name">ğŸ”’ password: VARCHAR(255)</text>
    <text x="95" y="320" class="field-name">ğŸ‘¤ full_name: VARCHAR(255)</text>
    <text x="95" y="340" class="field-name">ğŸ‘¥ role: ENUM(admin, moderator, user)</text>
    <text x="95" y="360" class="field-name">ğŸ–¼ï¸ avatar_url: TEXT</text>
    <text x="95" y="380" class="field-name">âœ“ email_verified: BOOLEAN</text>
    <text x="95" y="400" class="field-name">â° created_at: TIMESTAMP</text>
    <text x="95" y="420" class="field-name">â° updated_at: TIMESTAMP</text>
    <text x="95" y="460" class="field-type">ğŸ“Š INDEX: email, role, created_at</text>
  </g>

  <!-- SPOTS Table -->
  <g><rect x="520" y="200" width="300" height="420" fill="#DCFCE7" stroke="#10B981" stroke-width="2" rx="4"/>
    <rect x="520" y="200" width="300" height="35" fill="#10B981" rx="4"/>
    <text x="670" y="228" text-anchor="middle" class="table-name">SPOTS</text>
    <line x1="520" y1="235" x2="820" y2="235" stroke="#10B981" stroke-width="1"/>
    <text x="535" y="260" class="field-name">ğŸ”‘ id: INT | PK, AI</text>
    <text x="535" y="280" class="field-name">ğŸ“ location: GEOMETRY(Point)</text>
    <text x="535" y="300" class="field-name">ğŸ”— user_id: UUID | FK â†’ USERS</text>
    <text x="535" y="320" class="field-name">ğŸ·ï¸ category_id: INT | FK â†’ CATEGORIES</text>
    <text x="535" y="340" class="field-name">ğŸ“ title: VARCHAR(255)</text>
    <text x="535" y="360" class="field-name">ğŸ“„ description: TEXT</text>
    <text x="535" y="380" class="field-name">â­ difficulty: INT(1-5)</text>
    <text x="535" y="400" class="field-name">â­ avg_rating: NUMERIC(3,2)</text>
    <text x="535" y="420" class="field-name">ğŸ’¬ comment_count: INT (cached)</text>
    <text x="535" y="440" class="field-name">â¤ï¸ favorite_count: INT (cached)</text>
    <text x="535" y="460" class="field-name">â° created_at: TIMESTAMP</text>
    <text x="535" y="480" class="field-type">ğŸ“Š INDEX: location (GIST), user_id, category_id</text>
  </g>

  <!-- CATEGORIES Table -->
  <g><rect x="980" y="200" width="280" height="320" fill="#DCFCE7" stroke="#10B981" stroke-width="2" rx="4"/>
    <rect x="980" y="200" width="280" height="35" fill="#10B981" rx="4"/>
    <text x="1120" y="228" text-anchor="middle" class="table-name">CATEGORIES</text>
    <line x1="980" y1="235" x2="1260" y2="235" stroke="#10B981" stroke-width="1"/>
    <text x="995" y="260" class="field-name">ğŸ”‘ id: INT | PK, AI</text>
    <text x="995" y="280" class="field-name">ğŸ·ï¸ name: VARCHAR(100) UNIQUE</text>
    <text x="995" y="300" class="field-name">ğŸ“„ description: TEXT</text>
    <text x="995" y="320" class="field-name">ğŸ¨ color_hex: VARCHAR(7)</text>
    <text x="995" y="340" class="field-name">ğŸ–¼ï¸ icon_name: VARCHAR(50)</text>
    <text x="995" y="360" class="field-name">ğŸ“Š spot_count: INT (cached)</text>
    <text x="995" y="380" class="field-name">â° created_at: TIMESTAMP</text>
    <text x="995" y="420" class="field-type">ğŸ“Š INDEX: name</text>
  </g>

  <!-- COMMENTS Table -->
  <g><rect x="80" y="750" width="300" height="340" fill="#FEE2E2" stroke="#DC2626" stroke-width="2" rx="4"/>
    <rect x="80" y="750" width="300" height="35" fill="#DC2626" rx="4"/>
    <text x="230" y="778" text-anchor="middle" class="table-name">COMMENTS</text>
    <line x1="80" y1="785" x2="380" y2="785" stroke="#DC2626" stroke-width="1"/>
    <text x="95" y="810" class="field-name">ğŸ”‘ id: UUID | PK</text>
    <text x="95" y="830" class="field-name">ğŸ‘¤ user_id: UUID | FK â†’ USERS</text>
    <text x="95" y="850" class="field-name">ğŸ“ spot_id: INT | FK â†’ SPOTS</text>
    <text x="95" y="870" class="field-name">ğŸ’­ content: TEXT</text>
    <text x="95" y="890" class="field-name">ğŸ”— parent_id: UUID | FK â†’ COMMENTS</text>
    <text x="95" y="910" class="field-name">ğŸ‘ likes_count: INT</text>
    <text x="95" y="930" class="field-name">â° created_at: TIMESTAMP</text>
    <text x="95" y="970" class="field-type">ğŸ“Š INDEX: spot_id, user_id, parent_id</text>
  </g>

  <!-- RATINGS Table -->
  <g><rect x="520" y="750" width="280" height="320" fill="#FEE2E2" stroke="#DC2626" stroke-width="2" rx="4"/>
    <rect x="520" y="750" width="280" height="35" fill="#DC2626" rx="4"/>
    <text x="660" y="778" text-anchor="middle" class="table-name">RATINGS</text>
    <line x1="520" y1="785" x2="800" y2="785" stroke="#DC2626" stroke-width="1"/>
    <text x="535" y="810" class="field-name">ğŸ”‘ id: UUID | PK</text>
    <text x="535" y="830" class="field-name">ğŸ‘¤ user_id: UUID | FK</text>
    <text x="535" y="850" class="field-name">ğŸ“ spot_id: INT | FK</text>
    <text x="535" y="870" class="field-name">â­ rating: INT(1-5)</text>
    <text x="535" y="890" class="field-name">ğŸ’­ review: TEXT</text>
    <text x="535" y="910" class="field-name">âœ“ verified_visit: BOOLEAN</text>
    <text x="535" y="950" class="field-type">ğŸ“Š INDEX: spot_id, user_id</text>
  </g>

  <!-- FAVORITES Table -->
  <g><rect x="980" y="750" width="280" height="300" fill="#FEE2E2" stroke="#DC2626" stroke-width="2" rx="4"/>
    <rect x="980" y="750" width="280" height="35" fill="#DC2626" rx="4"/>
    <text x="1120" y="778" text-anchor="middle" class="table-name">FAVORITES</text>
    <line x1="980" y1="785" x2="1260" y2="785" stroke="#DC2626" stroke-width="1"/>
    <text x="995" y="810" class="field-name">ğŸ”‘ id: UUID | PK</text>
    <text x="995" y="830" class="field-name">ğŸ‘¤ user_id: UUID | FK</text>
    <text x="995" y="850" class="field-name">ğŸ“ spot_id: INT | FK</text>
    <text x="995" y="870" class="field-name">â¤ï¸ is_favorite: BOOLEAN</text>
    <text x="995" y="890" class="field-name">â° created_at: TIMESTAMP</text>
    <text x="995" y="930" class="field-type">ğŸ”„ UNIQUE: (user_id, spot_id)</text>
  </g>

  <!-- TAGS Table -->
  <g><rect x="1420" y="750" width="260" height="280" fill="#DCFCE7" stroke="#10B981" stroke-width="2" rx="4"/>
    <rect x="1420" y="750" width="260" height="35" fill="#10B981" rx="4"/>
    <text x="1550" y="778" text-anchor="middle" class="table-name">TAGS</text>
    <line x1="1420" y1="785" x2="1680" y2="785" stroke="#10B981" stroke-width="1"/>
    <text x="1435" y="810" class="field-name">ğŸ”‘ id: INT | PK, AI</text>
    <text x="1435" y="830" class="field-name">ğŸ·ï¸ name: VARCHAR(100) UNIQUE</text>
    <text x="1435" y="850" class="field-name">ğŸ“Š usage_count: INT</text>
    <text x="1435" y="870" class="field-name">â° created_at: TIMESTAMP</text>
    <text x="1435" y="910" class="field-type">ğŸ“Š INDEX: name</text>
  </g>

  <!-- SPOT_TAGS (Junction Table) -->
  <g><rect x="1840" y="750" width="260" height="280" fill="#DCFCE7" stroke="#10B981" stroke-width="2" rx="4"/>
    <rect x="1840" y="750" width="260" height="35" fill="#10B981" rx="4"/>
    <text x="1970" y="778" text-anchor="middle" class="table-name">SPOT_TAGS</text>
    <line x1="1840" y1="785" x2="2100" y2="785" stroke="#10B981" stroke-width="1"/>
    <text x="1855" y="810" class="field-name">ğŸ”‘ spot_id: INT | PK, FK</text>
    <text x="1855" y="830" class="field-name">ğŸ”‘ tag_id: INT | PK, FK</text>
    <text x="1855" y="850" class="field-name">ğŸ“Š relevance: INT</text>
    <text x="1855" y="870" class="field-name">â° created_at: TIMESTAMP</text>
  </g>

  <!-- IMAGES Table -->
  <g><rect x="80" y="1250" width="300" height="320" fill="#DCFCE7" stroke="#10B981" stroke-width="2" rx="4"/>
    <rect x="80" y="1250" width="300" height="35" fill="#10B981" rx="4"/>
    <text x="230" y="1278" text-anchor="middle" class="table-name">IMAGES</text>
    <line x1="80" y1="1285" x2="380" y2="1285" stroke="#10B981" stroke-width="1"/>
    <text x="95" y="1310" class="field-name">ğŸ”‘ id: UUID | PK</text>
    <text x="95" y="1330" class="field-name">ğŸ“ spot_id: INT | FK â†’ SPOTS</text>
    <text x="95" y="1350" class="field-name">ğŸ–¼ï¸ url: TEXT</text>
    <text x="95" y="1370" class="field-name">ğŸ“„ caption: VARCHAR(500)</text>
    <text x="95" y="1390" class="field-name">ğŸ“Š order_index: INT</text>
    <text x="95" y="1410" class="field-name">â° created_at: TIMESTAMP</text>
    <text x="95" y="1450" class="field-type">ğŸ“Š INDEX: spot_id</text>
  </g>

  <!-- REPORTS Table -->
  <g><rect x="520" y="1250" width="300" height="320" fill="#FEF3C7" stroke="#F59E0B" stroke-width="2" rx="4"/>
    <rect x="520" y="1250" width="300" height="35" fill="#F59E0B" rx="4"/>
    <text x="670" y="1278" text-anchor="middle" class="table-name">REPORTS</text>
    <line x1="520" y1="1285" x2="820" y2="1285" stroke="#F59E0B" stroke-width="1"/>
    <text x="535" y="1310" class="field-name">ğŸ”‘ id: UUID | PK</text>
    <text x="535" y="1330" class="field-name">ğŸ‘¤ reporter_id: UUID | FK</text>
    <text x="535" y="1350" class="field-name">ğŸ“ spot_id: INT | FK</text>
    <text x="535" y="1370" class="field-name">ğŸš© reason: VARCHAR(100)</text>
    <text x="535" y="1390" class="field-name">ğŸ“ description: TEXT</text>
    <text x="535" y="1410" class="field-name">âœ“ status: ENUM(pending, resolved)</text>
  </g>

  <!-- NOTIFICATIONS Table -->
  <g><rect x="980" y="1250" width="300" height="320" fill="#FEF3C7" stroke="#F59E0B" stroke-width="2" rx="4"/>
    <rect x="980" y="1250" width="300" height="35" fill="#F59E0B" rx="4"/>
    <text x="1130" y="1278" text-anchor="middle" class="table-name">NOTIFICATIONS</text>
    <line x1="980" y1="1285" x2="1280" y2="1285" stroke="#F59E0B" stroke-width="1"/>
    <text x="995" y="1310" class="field-name">ğŸ”‘ id: UUID | PK</text>
    <text x="995" y="1330" class="field-name">ğŸ‘¤ user_id: UUID | FK</text>
    <text x="995" y="1350" class="field-name">ğŸ“§ type: ENUM(comment, rating, reply)</text>
    <text x="995" y="1370" class="field-name">ğŸ“ message: TEXT</text>
    <text x="995" y="1390" class="field-name">ğŸ”— related_id: VARCHAR</text>
    <text x="995" y="1410" class="field-name">âœ“ is_read: BOOLEAN</text>
  </g>

  <!-- Footer -->
  <rect y="1750" width="3200" height="1050" fill="#F0F9FF" stroke="#10B981" stroke-width="2"/>
  <text x="100" y="1800" class="legend" font-weight="bold" font-size="14">CaracterÃ­sticas del Esquema:</text>
  <text x="100" y="1830" class="legend">âœ“ NormalizaciÃ³n 3NF | âœ“ UUIDs para transacciones distribuidas | âœ“ INTs para catÃ¡logos (mejor rendimiento)</text>
  <text x="100" y="1860" class="legend">âœ“ GEOMETRY(Point) con Ã­ndices GIST para geo-ubicaciÃ³n | âœ“ ENUMs para estados y roles</text>
  <text x="100" y="1890" class="legend">âœ“ Contadores desnormalizados (avg_rating, comment_count) mantenidos por triggers | âœ“ Estrategia cachÃ© inteligente</text>
  <text x="100" y="1920" class="legend">âœ“ ON DELETE CASCADE para comentarios/imÃ¡genes | âœ“ ON DELETE SET NULL para favoritos/reportes</text>
  <text x="100" y="1950" class="legend">âœ“ Ãndices en FKs, bÃºsquedas comunes | âœ“ UNIQUE constraints: email, category name, tag name</text>
  <text x="100" y="1980" class="legend">âœ“ Composite UNIQUE: (user_id, spot_id) en FAVORITES | âœ“ Auto-increment en INTs con SERIAL</text>
  <text x="100" y="2010" class="legend">âœ“ Timestamps con NOW() default | âœ“ RelaciÃ³n N:M mediante tabla de uniÃ³n SPOT_TAGS</text>
  <text x="100" y="2040" class="legend">âœ“ Auto-relaciÃ³n: COMMENTS.parent_id para soportar threads de comentarios | âœ“ Prepared statements para seguridad</text>
  <text x="1600" y="2750" class="legend" text-anchor="middle" font-size="11">Â© 2024 SpotMap - Esquema Relacional Optimizado | PostgreSQL 14+ con PostGIS 3.2+ | ORM: Doctrine 2.13+</text>
</svg>
