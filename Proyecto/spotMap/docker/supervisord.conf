# Supervisor Configuration for SpotMap
# ⚠️ PROPRIETARY CODE - DO NOT DISTRIBUTE
# Manages PHP-FPM and Nginx in Docker container

[supervisord]
nodaemon = true
logfile = /app/logs/supervisord.log
pidfile = /var/run/supervisord.pid
childlogdir = /app/logs

[unix_http_server]
file = /var/run/supervisor.sock
chmod = 0700

[supervisorctl]
serverurl = unix:///var/run/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

; ================================================================================
; PHP-FPM Process
; ================================================================================
[program:php-fpm]
command = /usr/local/sbin/php-fpm -F
stdout_logfile = /app/logs/php-fpm-stdout.log
stderr_logfile = /app/logs/php-fpm-stderr.log
autorestart = true
autostart = true
priority = 10
startsecs = 5
stopwaitsecs = 10

; ================================================================================
; Nginx Web Server
; ================================================================================
[program:nginx]
command = /usr/sbin/nginx -g "daemon off;"
stdout_logfile = /app/logs/nginx-stdout.log
stderr_logfile = /app/logs/nginx-stderr.log
autorestart = true
autostart = true
priority = 20
startsecs = 5
stopwaitsecs = 10

; Stop method: send SIGTERM
stopsignal = TERM

; ================================================================================
; Event Listener for Process State Changes
; ================================================================================
[eventlistener:processes]
buffer_size = 100
events = PROCESS_STATE
result_handler = handler_process_state

[unix_http_server]
file = /var/run/supervisor.sock

[supervisorctl]
serverurl = unix:///var/run/supervisor.sock
